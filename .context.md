# SNES Disassembler Project Context

This file provides essential context for working with the SNES Disassembler project, including testing guidelines, directory conventions, and available resources.

## Project Overview

The SNES Disassembler is a comprehensive tool for extracting and analyzing assets from Super Nintendo Entertainment System (SNES) ROM files. It provides:
- 65816 assembly code disassembly
- Graphics asset extraction (tiles, sprites, palettes)
- Audio asset extraction (BRR samples, SPC700 code)
- Text and dialogue extraction
- Multiple output formats (CA65, WLA-DX, bass, HTML, JSON, etc.)

## Directory Structure

```
snes-disassembler/
├── src/                    # TypeScript source files
├── dist/                   # Compiled JavaScript output
├── docs/                   # Documentation (ALWAYS output markdown here)
├── output/                 # CLI test output (ALWAYS use for testing)
├── roms/                   # ROM files for testing
├── snes_games/            # Test ROM directory (USE FOR ALL TESTING)
├── examples/              # Example usage and demos
├── tests/                 # Test files
└── node_modules/          # Dependencies
```

## Testing Guidelines

### 1. ROM Testing Directory
**ALWAYS use `snes_games/` directory for test ROMs:**
```bash
# Example: Test with a ROM from snes_games
node dist/cli.js snes_games/game_name.smc --output-dir output/ [options]
```

### 2. Output Directory Convention
**ALWAYS output CLI results to the `output/` directory:**
```bash
# Correct usage
node dist/cli.js snes_games/alttp.smc --output-dir output/alttp_test --extract-assets

# Create subdirectories for different tests
node dist/cli.js snes_games/mario.smc --output-dir output/mario_test --analysis
```

### 3. Documentation Directory
**ALWAYS save markdown documentation to the `docs/` directory:**
```bash
# When creating documentation
docs/
├── API_Reference.md
├── Asset_Extraction_Guide.md
├── CLI_Usage.md
└── Development_Notes.md
```

## Available MCP Servers

The following MCP (Model Context Protocol) servers provide reference implementations and documentation:

### 1. **snes-mcp-server**
- **Purpose**: SNES architecture and 65816 assembly language reference
- **Key Resources**:
  - Instruction set documentation
  - Memory mapping information
  - Hardware register details
  - Graphics and audio specifications

### 2. **snes9x**
- **Purpose**: SNES emulator implementation reference
- **Key Insights**:
  - Accurate CPU emulation
  - PPU (Picture Processing Unit) implementation
  - APU (Audio Processing Unit) details
  - Timing and synchronization

### 3. **snes-mister**
- **Purpose**: FPGA implementation of SNES hardware
- **Key Resources**:
  - Hardware-accurate implementations
  - Cycle-accurate timing
  - Special chip implementations (SA-1, SuperFX, etc.)
  - Savestate system architecture

### 4. **zelda3**
- **Purpose**: Fully reverse-engineered A Link to the Past implementation
- **Key Insights**:
  - Game engine patterns
  - Asset organization
  - Compression algorithms
  - Memory layout examples

## Common CLI Commands

### Basic Disassembly
```bash
# Simple disassembly
node dist/cli.js snes_games/game.smc --output-dir output/game_disasm

# With analysis
node dist/cli.js snes_games/game.smc --output-dir output/game_analysis --analysis --verbose
```

### Asset Extraction
```bash
# Extract all assets
node dist/cli.js snes_games/game.smc --output-dir output/game_assets --extract-assets

# Extract specific formats
node dist/cli.js snes_games/game.smc --output-dir output/game_graphics \
  --extract-assets --asset-types graphics --asset-formats 2bpp,4bpp,8bpp
```

### Output Formats
```bash
# Different assembler formats
node dist/cli.js snes_games/game.smc --output-dir output/game_ca65 --format ca65
node dist/cli.js snes_games/game.smc --output-dir output/game_wla --format wla-dx
node dist/cli.js snes_games/game.smc --output-dir output/game_bass --format bass
```

## Development Workflow

### 1. Building the Project
```bash
npm run build
```

### 2. Running Tests
```bash
# Use test ROMs from snes_games/
npm test

# Test specific functionality
node dist/cli.js snes_games/test_rom.smc --output-dir output/test_results --verbose
```

### 3. Creating Documentation
```bash
# Always save to docs/
echo "# New Feature Documentation" > docs/New_Feature.md
```

## Best Practices

1. **Testing**: Always test with multiple games from `snes_games/` to ensure generic compatibility
2. **Output Organization**: Create descriptive subdirectories in `output/` for each test run
3. **Documentation**: Keep all markdown files in `docs/` with clear, descriptive names
4. **MCP References**: Consult the MCP servers for hardware-accurate implementations
5. **Version Control**: Don't commit the `output/` directory contents (it's for testing only)

## Environment Variables

```bash
# Optional: Set default directories
export SNES_TEST_ROMS="./snes_games"
export SNES_OUTPUT_DIR="./output"
export SNES_DOCS_DIR="./docs"
```

## Quick Reference

| Task | Command |
|------|---------|
| Build project | `npm run build` |
| Basic disassembly | `node dist/cli.js snes_games/game.smc --output-dir output/game` |
| Extract assets | `node dist/cli.js snes_games/game.smc --output-dir output/game --extract-assets` |
| Generate docs | Save to `docs/` directory |
| View help | `node dist/cli.js --help` |

## Notes

- The `snes_games/` directory should contain legally obtained SNES ROM files for testing
- The `output/` directory is gitignored and used for temporary test results
- All project documentation should be maintained in the `docs/` directory
- Reference the MCP servers for accurate SNES hardware behavior
- Focus on generic implementations that work across all SNES games

---

*Last Updated: July 27, 2025*
